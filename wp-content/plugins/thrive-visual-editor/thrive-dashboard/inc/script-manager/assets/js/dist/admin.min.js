!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=71)}({12:function(e,t){var s;s=jQuery,e.exports={_t:function(e){var t=s("script#"+e).html()||"";return _.template(t)}}},14:function(e,t,s){!function(t){s(12);var i={};i.ScriptItem=Backbone.Model.extend({idAttribute:"id",defaults:{label:"",status:{lp:!0,ttb:!0},placement:"",code:"",order:0,icon:"nonstandard"},url:function(){return TVD_SM_CONST.routes.scripts+(this.get("id")?"/"+this.get("id"):"")},sync:function(e,t,s){var i;return(s=s||{}).cache=!1,s.url=this.url(),_.isUndefined(TVD_SM_CONST.nonce)||_.isNull(TVD_SM_CONST.nonce)||(i=s.beforeSend,s.beforeSend=function(e){if(e.setRequestHeader("X-WP-Nonce",TVD_SM_CONST.nonce),i)return i.apply(this,arguments)}),Backbone.sync(e,t,s)}}),i.collections={ScriptCollection:Backbone.Collection.extend({model:i.ScriptItem,comparator:"order",url:function(){return TVD_SM_CONST.routes.scripts},sync:function(e,t,s){var i;return(s=s||{}).cache=!1,_.isUndefined(TVD_SM_CONST.nonce)||_.isNull(TVD_SM_CONST.nonce)||(i=s.beforeSend,s.beforeSend=function(e){if(e.setRequestHeader("X-WP-Nonce",TVD_SM_CONST.nonce),i)return i.apply(this,arguments)}),Backbone.sync(e,t,s)}})},e.exports=i}(jQuery)},71:function(e,t,s){e.exports=s(72)},72:function(e,t,s){!function(e){_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},Backbone.emulateHTTP=!0;var t=t||{};e.extend(t,{sm_router:Backbone.Router.extend({view:null,$el:e("#tvd-sm-container"),routes:{"":"dashboard"},dashboard:function(){this.view&&this.view.remove(),this.view=new t.views.ScriptDashboard({el:this.$el})}}),utils:s(12),models:s(14),views:s(73)}),t.router=new t.sm_router,Backbone.history.start({hashchange:!0})}(jQuery)},73:function(e,t,s){var i,n,r,o,c,a;i=jQuery,r=s(12),o=s(14),a=!1,(c={}).ScriptDashboard=Backbone.View.extend({template:r._t("dashboard"),events:{"click .tvd-add-modal":"addScript","click #tvd-sm-theme-link":"setLinkTarget"},initialize:function(){this.breadcrumbs=new c.Breadcrumbs({el:this.$el.closest("#tvd-sm-wrapper").prev()}),this.render(),i("#tvd-delete-page-level-scripts").on("click",(function(){TVE_Dash.modal(c.DeletePageLevelScriptsModal)})),n=new o.collections.ScriptCollection(TVD_SM_CONST.scripts),new c.ScriptGroup({collection:n,_type:"head",el:this.$("#tvd-sm-container-head")}),new c.ScriptGroup({collection:n,_type:"body_open",el:this.$("#tvd-sm-container-body-open")}),new c.ScriptGroup({collection:n,_type:"body_close",el:this.$("#tvd-sm-container-body-close")})},render:function(){this.$el.html(this.template())},addScript:function(){TVE_Dash.modal(c.AddEditScriptModal,{collection:n,message:TVD_SM_CONST.translations.add_script})},setLinkTarget:function(){localStorage.setItem("ThriveOptionsSelectedItem","analytics-options")}}),c.ScriptGroup=Backbone.View.extend({initialize:function(e){var t=this;this.options=e,this.$el.sortable({axis:"y",connectWith:i(".tvd-sm-script-group"),handle:".tvd-icon-handle",start:function(e,t){t.item.addClass("tvd-sm-script-drag")},stop:function(e,t){t.item.removeClass("tvd-sm-script-drag")},update:function(e,s){var i=s.item.parent()[0];s.sender||this!==i?this!==i&&1===t.collection.where({placement:t.options._type}).length&&t.$el.append(t.renderEmpty().$el):t.updateOrder(e,s)},receive:function(e,s){t.updateOrder(e,s)}}),this.listenTo(this.collection,"change",(function(e,t){"noChange"!==t.flag&&this.render()})),this.listenTo(this.collection,"add destroy",(function(e){e.attributes.placement===this.options._type&&this.render()})),this.render()},updateOrder:function(e,t){var s=this,n=this.$el.sortable("toArray",{attribute:"data-id"});i.post({headers:{"X-WP-Nonce":TVD_SM_CONST.nonce},url:TVD_SM_CONST.routes.scripts_order,data:{scripts:n},success:function(){var i=0;if(_.each(n,(function(e){s.collection.get(e).set({order:i++},{silent:!0})})),t.sender){var r=s.collection.get(t.item.data("id"));r.save({placement:e.target.dataset.placement},{silent:!0}),s.$el.hasClass("tvd-sm-no-scripts")&&(s.$el.empty().removeClass("tvd-sm-no-scripts"),s.renderOne(r))}}})},renderOne:function(e){this.$el.append(new c.ScriptItem({model:e}).render().$el)},renderEmpty:function(){return this.$el.append(TVD_SM_CONST.translations.no_scripts_in_this_group).addClass("tvd-sm-no-scripts"),this},render:function(){this.$el.empty(),this.$el.attr("data-placement",this.options._type),this.collection.sort();var e=this.collection.where({placement:this.options._type});return _.each(e,(function(e){this.renderOne(e)}),this),0===e.length?this.$el.append(this.renderEmpty().$el):this.$el.hasClass("tvd-sm-no-scripts")&&this.$el.removeClass("tvd-sm-no-scripts"),this}}),c.ScriptItem=Backbone.View.extend({className:"tvd-sm-script-item",template:r._t("script-item"),events:{"click .tvd-edit-modal":"editScript","click .tvd-delete-modal":"deleteScript","change .tvd-sm-script-elem-switch":"toggleEnable"},initialize:function(){this.listenTo(this.model,"change",this.render)},toggleEnable:function(e){var t=this;if(a)setTimeout((function(){t.toggleEnable(e)}),200);else{a=!0;var s=this.model.get("status");s[e.target.dataset.location]=e.target.checked,this.model.set("status",s).save({},{flag:"noChange",success:function(){a=!1,TVE_Dash.success(TVD_SM_CONST.translations.edit_success)},error:function(){TVE_Dash.err(TVD_SM_CONST.translations.edit_error)}})}},formIconClass:function(){return"tvd-sm-icon img-"+this.model.get("icon")},render:function(){return this.$el.html(this.template({model:this.model})),this.$el.attr("data-id",this.model.get("id")),this.$el.attr("data-placement",this.model.get("placement")),this},editScript:function(){TVE_Dash.modal(c.AddEditScriptModal,{model:this.model,message:TVD_SM_CONST.translations.edit_script})},deleteScript:function(){TVE_Dash.modal(c.DeleteScriptModal,{model:this.model,className:"tvd-modal tvd-sm-delete-script"})}}),c.AddEditScriptModal=TVE_Dash.views.Modal.extend({template:r._t("modal-add-edit-script"),events:{"click .tvd-submit":"save","change #tvd-sm-script-code":"recognizeScript","focusin .tvd-sm-form-element":"focusLabel","blur .tvd-sm-form-element":"blurLabel"},save:function(){var e={label:this.$("#tvd-sm-script-name").val(),status:{ttb:this.$("#tvd-sm-script-checkbox-ttb").is(":checked"),lp:this.$("#tvd-sm-script-checkbox-lp").is(":checked")},placement:this.$("#tvd-sm-script-placement").val(),code:this.$("#tvd-sm-script-code").val(),icon:this.$("#tvd-sm-script-icon").val()};if(TVD_SM_CONST.is_ttb_active&&TVD_SM_CONST.is_tar_active||(e.status={ttb:TVD_SM_CONST.is_ttb_active,lp:TVD_SM_CONST.is_ttb_active}),!this.validate(e))return!1;e.label=i("<div>").html(e.label).text(),e.icon||(e.icon="nonstandard"),void 0!==this.collection?this.addScript(e):this.editScript(e)},addScript:function(e){var t=this,s=this.collection.where({placement:e.placement});e.order=s.length>0?s[s.length-1].get("order")+1:0,this.collection.create(e,{success:function(){t.close()},error:function(){TVE_Dash.err(TVD_SM_CONST.translations.add_error)},flag:"noChange"})},editScript:function(e){var t=this,s=n.where({placement:e.placement});this.model.get("placement")!==e.placement&&(e.order=s.length>0?s[s.length-1].get("order")+1:0),this.model.save(e,{success:function(){t.close()},error:function(){TVE_Dash.err(TVD_SM_CONST.translations.edit_error)}})},validate:function(e){var t=e.code,s=e.label,i=e.placement;return t?(this.$("#tvd-sm-code-empty").hide(),s?(this.$("#tvd-sm-label-empty").hide(),i?(this.$("#tvd-sm-placement-empty").hide(),this.checkTags(t)?(this.$("#tvd-sm-code-invalid").hide(),!0):(this.$("#tvd-sm-code-invalid").show(),!1)):(this.$("#tvd-sm-placement-empty").show(),!1)):(this.$("#tvd-sm-label-empty").show(),!1)):(this.$("#tvd-sm-code-empty").show(),!1)},checkTags:function(e){if(void 0===_.find(["script","noscript","iframe"],(function(t){return e.split("<"+t).length!==e.split("</"+t+">").length})))return!0},recognizeScript:function(){var e=this.$("#tvd-sm-script-code").val(),t=_.findKey(TVD_SM_CONST.recognized_scripts.keywords,(function(t){return _.find(t,(function(t){return-1!==e.indexOf(t)}))}));if(void 0!==t){var s=TVD_SM_CONST.recognized_scripts.data[t];this.$("#tvd-sm-script-name").val(t),this.$("#tvd-sm-script-placement").val(s.placement).change(),this.$("#tvd-sm-script-icon").val(s.icon)}else this.$("#tvd-sm-script-icon").val("nonstandard")},focusLabel:function(e){i(e.target).closest(".tvd-sm-form-element").addClass("tvd-sm-focused-label"),e.target.classList.contains("select2-selection")&&this.$("#tvd-sm-script-placement").select2("open")},blurLabel:function(e){i(e.target).closest(".tvd-sm-form-element").removeClass("tvd-sm-focused-label")}}),c.DeleteScriptModal=TVE_Dash.views.Modal.extend({template:r._t("modal-delete-script"),events:{"click .tvd-submit":"delete"},delete:function(){this.model.destroy({error:function(){TVE_Dash.err(TVD_SM_CONST.translations.delete_error)}}),this.close()}}),c.DeletePageLevelScriptsModal=TVE_Dash.views.Modal.extend({template:r._t("modal-delete-page-level-scripts"),events:{"click .tvd-submit":"delete"},delete:function(){i.post({headers:{"X-WP-Nonce":TVD_SM_CONST.nonce},url:TVD_SM_CONST.routes.clear_page_level_scripts,success:function(){TVE_Dash.success(TVD_SM_CONST.translations.delete_page_level_success)},error:function(){TVE_Dash.err(TVD_SM_CONST.translations.delete_page_level_error)}}),this.close()}}),c.Breadcrumbs=Backbone.View.extend({template:r._t("breadcrumbs"),initialize:function(){this.render()},render:function(){return this.$el.html(this.template()),this}}),e.exports=c}});